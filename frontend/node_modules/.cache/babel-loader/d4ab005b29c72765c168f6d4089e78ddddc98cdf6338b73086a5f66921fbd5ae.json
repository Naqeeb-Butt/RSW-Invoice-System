{"ast":null,"code":"import _objectSpread from\"D:/Invoice System/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import axios from'axios';import{useNavigate,useParams}from'react-router-dom';import{Save,Plus,Trash2,ArrowLeft,Calculator}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function InvoiceForm(){const navigate=useNavigate();const{id}=useParams();const isEditing=Boolean(id);const[loading,setLoading]=useState(false);const[clients,setClients]=useState([]);const[formData,setFormData]=useState({invoice_number:'',po_number:'',invoice_date:new Date().toISOString().split('T')[0],due_date:'',status:'draft',notes:'',client_id:''});const[items,setItems]=useState([{description:'',quantity:1,unit:'EA',unit_price:0,tax_rate:0}]);useEffect(()=>{fetchClients();if(isEditing){fetchInvoice();}},[isEditing,id]);const fetchClients=async()=>{try{const response=await axios.get('/api/v1/clients');setClients(response.data);}catch(error){console.error('Failed to fetch clients:',error);}};const fetchInvoice=async()=>{try{const response=await axios.get(\"/api/v1/invoices/\".concat(id));const invoice=response.data;setFormData({invoice_number:invoice.invoice_number,po_number:invoice.po_number||'',invoice_date:invoice.invoice_date.split('T')[0],due_date:invoice.due_date?invoice.due_date.split('T')[0]:'',status:invoice.status,notes:invoice.notes||'',client_id:invoice.client_id});setItems(invoice.items.map(item=>({description:item.description,quantity:item.quantity,unit:item.unit,unit_price:item.unit_price,tax_rate:item.tax_rate})));}catch(error){console.error('Failed to fetch invoice:',error);}};const handleInputChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const handleItemChange=(index,field,value)=>{const newItems=[...items];newItems[index]=_objectSpread(_objectSpread({},newItems[index]),{},{[field]:field==='quantity'||field==='unit_price'||field==='tax_rate'?parseFloat(value)||0:value});setItems(newItems);};const addItem=()=>{setItems([...items,{description:'',quantity:1,unit:'EA',unit_price:0,tax_rate:0}]);};const removeItem=index=>{if(items.length>1){setItems(items.filter((_,i)=>i!==index));}};const calculateTotals=()=>{let subtotal=0;let totalTax=0;items.forEach(item=>{const itemTotal=item.quantity*item.unit_price;const itemTax=itemTotal*(item.tax_rate/100);subtotal+=itemTotal;totalTax+=itemTax;});return{subtotal,totalTax,total:subtotal+totalTax};};const handleSubmit=async e=>{e.preventDefault();setLoading(true);try{const payload=_objectSpread(_objectSpread({},formData),{},{invoice_date:new Date(formData.invoice_date).toISOString(),due_date:formData.due_date?new Date(formData.due_date).toISOString():null,items:items.filter(item=>item.description&&item.unit_price>0)});if(isEditing){await axios.put(\"/api/v1/invoices/\".concat(id),payload);}else{await axios.post('/api/v1/invoices',payload);}navigate('/invoices');}catch(error){console.error('Failed to save invoice:',error);alert('Failed to save invoice. Please try again.');}finally{setLoading(false);}};const totals=calculateTotals();return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/invoices'),className:\"mr-4 text-gray-600 hover:text-gray-900\",children:/*#__PURE__*/_jsx(ArrowLeft,{className:\"h-5 w-5\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900\",children:isEditing?'Edit Invoice':'Create Invoice'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:isEditing?'Update invoice information':'Create a new invoice'})]})]})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"Invoice Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Invoice Number\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"invoice_number\",value:formData.invoice_number,onChange:handleInputChange,required:true,className:\"input-field\",placeholder:\"INV-0001\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"PO Number\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"po_number\",value:formData.po_number,onChange:handleInputChange,className:\"input-field\",placeholder:\"PO-12345\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Client\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"client_id\",value:formData.client_id,onChange:handleInputChange,required:true,className:\"input-field\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a client\"}),clients.map(client=>/*#__PURE__*/_jsx(\"option\",{value:client.id,children:client.name},client.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Invoice Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"invoice_date\",value:formData.invoice_date,onChange:handleInputChange,required:true,className:\"input-field\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Due Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"due_date\",value:formData.due_date,onChange:handleInputChange,className:\"input-field\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Status\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"status\",value:formData.status,onChange:handleInputChange,className:\"input-field\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"draft\",children:\"Draft\"}),/*#__PURE__*/_jsx(\"option\",{value:\"sent\",children:\"Sent\"}),/*#__PURE__*/_jsx(\"option\",{value:\"paid\",children:\"Paid\"}),/*#__PURE__*/_jsx(\"option\",{value:\"overdue\",children:\"Overdue\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Notes\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"notes\",value:formData.notes,onChange:handleInputChange,rows:3,className:\"input-field\",placeholder:\"Additional notes...\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-gray-900\",children:\"Line Items\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:addItem,className:\"btn btn-secondary flex items-center\",children:[/*#__PURE__*/_jsx(Plus,{className:\"h-4 w-4 mr-2\"}),\"Add Item\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Description\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Quantity\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Unit\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Unit Price\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Tax %\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Total\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:items.map((item,index)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:item.description,onChange:e=>handleItemChange(index,'description',e.target.value),className:\"input-field text-sm\",placeholder:\"Item description\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3\",children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",value:item.quantity,onChange:e=>handleItemChange(index,'quantity',e.target.value),className:\"input-field text-sm w-20\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:item.unit,onChange:e=>handleItemChange(index,'unit',e.target.value),className:\"input-field text-sm w-16\",placeholder:\"EA\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3\",children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",value:item.unit_price,onChange:e=>handleItemChange(index,'unit_price',e.target.value),className:\"input-field text-sm w-24\",placeholder:\"0.00\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3\",children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",value:item.tax_rate,onChange:e=>handleItemChange(index,'tax_rate',e.target.value),className:\"input-field text-sm w-16\",placeholder:\"0\"})}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-3 text-sm text-gray-900\",children:[\"$\",(item.quantity*item.unit_price).toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>removeItem(index),className:\"text-red-600 hover:text-red-900\",disabled:items.length===1,children:/*#__PURE__*/_jsx(Trash2,{className:\"h-4 w-4\"})})})]},index))})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card p-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full md:w-1/3 space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Subtotal:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[\"$\",totals.subtotal.toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Tax:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[\"$\",totals.totalTax.toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-lg font-bold text-gray-900 pt-2 border-t\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Total:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"$\",totals.total.toFixed(2)]})]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>navigate('/invoices'),className:\"btn btn-secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",disabled:loading,className:\"btn btn-primary flex items-center\",children:[/*#__PURE__*/_jsx(Save,{className:\"h-4 w-4 mr-2\"}),loading?'Saving...':isEditing?'Update Invoice':'Create Invoice']})]})]})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}